define(["jquery","jqueryui"],function(a){var b=function(b){this.debug=b,this.log("Creating object"),this.elem=a("#timepicker"),this.today=!0,this.busy_slots=null,this.slot_size=-1,this.hcells().on("click",{tpicker:this},this.on_hour_click),this.pick_default_hour()};return b.prototype.log=function(a){this.debug&&console.log("[TIMEPICKER] "+a)},b.prototype.hcells=function(){return this.elem.find("table#hour td.hour")},b.prototype.icells=function(){return this.elem.find("table#interval td")},b.prototype.pick_default_hour=function(){this.hcells().first().click()},b.prototype.is_interval_picker_init=function(){return this.icells().length>0},b.prototype.pick_default_interv=function(){this.icells().first().click().fadeIn("fast")},b.prototype.get_current_hour=function(){var a=this.get_current_hour_item();if(0==a.length)return null;var b=this.get_current_hour_item().text(),c=this.convert_12to24(b);return b=c.toString(),c<10&&(b="0"+b),b},b.prototype.get_current_hour_item=function(){return this.hcells().filter(".hour-current")},b.prototype.get_real_hour=function(){var a=new Date;return a.getHours()},b.prototype.is_current_hour_outdated=function(){return this.get_current_hour()<this.get_real_hour()},b.prototype.convert_12to24=function(a){if(""==a)return null;var b=a.substring(a.length-2);a=a.substr(0,a.length-2);var c=parseInt(a);return"PM"==b&&(c+=12),c},b.prototype.get_current_interv=function(){var a=this.get_current_interv_item();return 0==a.length?null:this.get_current_interv_item().text()},b.prototype.get_current_interv_item=function(){return this.icells().filter("td.interv-current")},b.prototype.get_current_time=function(){var a=this.get_current_hour(),b=this.get_current_interv();return a+b},b.prototype.set_today=function(a){this.log("today= "+a),this.today=a},b.prototype.set_slot_size=function(a){this.log("slot-size="+a),this.slot_size=a},b.prototype.is_today=function(){return this.today},b.prototype.is_current_hour_select=function(){return this.get_current_hour()==this.get_real_hour()},b.prototype.clear_past_hours=function(){this.hcells().removeClass("hour-past disabled").on("click",{tpicker:this},this.on_hour_click)},b.prototype.clear_past_interv=function(){this.icells().removeClass("interv-past"),this.icells().not(".interv-busy").removeClass("disabled").on("click",{tpicker:this},this.on_interv_click)},b.prototype.clear_interv=function(){this.icells().removeClass("interv-past interv-busy disabled"),this.icells().on("click",{tpicker:this},this.on_interv_click)},b.prototype.clear_busy_interv=function(){this.icells().removeClass("interv-busy"),this.icells().not(".interv-past").removeClass("disabled").on("click",{tpicker:this},this.on_interv_click)},b.prototype.clear_past=function(){this.clear_past_hours(),this.clear_past_interv()},b.prototype.clear=function(){this.unselect_hour(),this.unselect_interval()},b.prototype.select_hour=function(a){this.log("hour="+a.text()),a.addClass("time-highlight hour-current")},b.prototype.unselect_hour=function(){this.log("hour={}"),this.hcells().removeClass("time-highlight hour-current")},b.prototype.set_past_hour=function(a){a.addClass("hour-past disabled"),a.off()},b.prototype.select_interval=function(a){this.log("interv="+a.text()),a.addClass("time-highlight interv-current")},b.prototype.unselect_interval=function(){this.log("interv={}"),this.icells().removeClass("time-highlight interv-current")},b.prototype.update_interval=function(){this.log("Updating interv picker ("+this.slot_size+")");var a=this.slot_size,b=this,c=this.elem.find("table#interval");c.find("td").remove(),c.find("tr").append("<td>:00</td>");for(var d=a;d<60;){var e=d;d<10&&(e="0"+e);var f="<td>:"+e+"</td>";c.find("tr").append(f),d+=a}b.icells().on("click",{tpicker:this},this.on_interv_click),this.icells().length>8?c.css("overflow-x","scroll"):c.css("overflow-x","hidden"),b.disable_busy_interv(),b.disable_past_interv(),b.next_free_interv()},b.prototype.on_hour_click=function(b){b.preventDefault();var c=b.data.tpicker;c.log("hour click <EVENT>");a(this).text();c.unselect_hour(),c.select_hour(a(this)),c.clear_interv(),c.is_today()&&c.get_current_hour()==c.get_real_hour()&&c.disable_past_interv(),c.disable_busy_interv(),c.next_free_interv()},b.prototype.on_interv_click=function(b){var c=b.data.tpicker;c.log("interval click <EVENT>"),b.preventDefault(),c.unselect_interval(),c.select_interval(a(this))},b.prototype.disable_past_hours=function(){var b=this,c=this.hcells(),d=new Date,e=d.getHours();return this.is_today()?(b.log("Disabling past hours:"+e),void c.each(function(c){var d=b.convert_12to24(a(this).text());return d<e&&void b.set_past_hour(a(this))})):(b.log("NOT disabling past hours"),void this.clear_past_hours())},b.prototype.next_free_hour=function(){var a=this,b=this.get_current_hour_item(),c=this.hcells().index(b);a.log("next free hour"),c<0?(a.log("No hour selected"),b=this.hcells().first(),c=0):this.unselect_hour();var d=this.hcells().filter(":not(.disabled)").first();d.length>0&&this.select_hour(d)},b.prototype.set_busy=function(a){this.busy_slots=a},b.prototype.add_busy=function(a){null==this.busy_slots&&(this.busy_slots=[]),this.busy_slots.push(a),this.busy_slots.sort()},b.prototype.del_busy=function(a){if(null!=this.busy_slots){var b=this.busy_slots.indexOf(a);b>0&&this.busy_slots.splice(b,1)}},b.prototype.set_past_interv=function(a){a.addClass("interval-busy disabled"),a.off()},b.prototype.set_busy_interv=function(a){a.addClass("interval-busy disabled"),a.off()},b.prototype.disable_busy_interv=function(){var b=this;return null==b.busy_slots||0==b.busy_slots.length?void b.log("No busy slots found"):(b.log("Disabling busy slots"),void this.elem.find("table#interval td").each(function(c,d){time=b.get_current_hour()+a(this).text(),b.busy_slots.includes(time)&&(b.log("Disabling "+time),b.set_busy_interv(a(this)))}))},b.prototype.update_busy_interv=function(){this.clear_busy_interv(),this.disable_busy_interv(),this.next_free_interv()},b.prototype.disable_past_interv=function(){var b=this,c=this.icells(),d=new Date,e=d.getHours(),f=parseInt(d.getMinutes()),g=this.get_current_hour();return g!=e?(b.log("No past intervals to remove "+g+" "+e),void b.clear_past_interv()):(b.log("Disabling previous intervals: 0-"+f),void c.each(function(){return null!=a(this).next()?end=parseInt(a(this).next().text().substring(1)):end=60,end<=f&&(a(this).addClass("interv-past disabled"),void a(this).off())}))},b.prototype.next_free_interv=function(){var a=this,b=this.get_current_interv_item(),c=this.icells().index(b);if(a.log("next free interv"),a.unselect_interval(),!this.is_interval_picker_init())return void a.log("Interval picker not found");c<0&&(a.log("No interval selected"),b=this.icells().first(),c=0),b.hasClass("disabled")&&this.unselect_interval();var d=this.icells().filter(":not(.disabled)").first();d.length>0&&(this.select_interval(d),this.scrollTo(d))},b.prototype.scrollTo=function(a){this.log("Scrolling to "+a.text()),a.get(0).scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},b});