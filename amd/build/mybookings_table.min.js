define(["jquery","jqueryui"],function(a){var b=function(b){this.debug=b.debug,this.delete_base_url=b.controllerspath+"/delete_booking.php?id="+b.course_id,this.elem=a("table#mybookings"),this.datepicker=b.datepicker,this.timepicker=b.timepicker,this.log("Creating object")};return b.prototype.log=function(a){this.debug&&console.log("[TABLE] "+a)},b.prototype.populate=function(a){this.log("Clearing"),this.elem.children("tbody").html(""),this.log("Populating");for(var b,c=0;c<a.bookings.length;c++){b=a.bookings[c];var d=this.create_row(b.day,b.labname,b.time,b.id);this.append_item(d)}this.update_visibility(),a.bookings.length>0&&this.paginate()},b.prototype.append_item=function(a){this.elem.find("tbody").append(a)},b.prototype.create_row=function(b,c,d,e){var f=a("<tr><td> &nbsp; </td><td>"+b+"</td><td>"+c+"</td><td>"+d+'</td><td class="text-center del_btn_cell" id="'+e+'"><a class="del_btn"><span class="ui-icon ui-icon-trash" >&nbsp;</span></a></td></tr>');return f.find("a").on("click",{mybookings:this,timepicker:this.timepicker,datepicker:this.datepicker,bookid:e},this.on_delete_item),f},b.prototype.update=function(a,b,c,d){var e=this.create_row(a,b,c,d);this.add_sorted(a,c,e),this.update_visibility()},b.prototype.add_sorted=function(b,c,d){var e=new Date(b+" "+c);return 0==this.elem.find("tbody").children().length?void this.elem.find("tbody").html(d):void this.elem.find("tbody > tr").each(function(){var b=a(this).find("td:nth-child(2)").text(),c=a(this).find("td:nth-child(4)").text(),f=new Date(b+" "+c);return e<f?(a(this).before(d),!1):void(a(this).is(":last-child")&&a(this).after(d))})},b.prototype.update_visibility=function(){var b=this.elem.find("tbody > tr").length;this.log("Updating visibility ("+b+")"),b>0?(this.log("contain items"),this.elem.show(),a("#pagination").show(),a("#mybookings_notif").hide()):(this.log("empty"),this.elem.hide(),a("#pagination").hide(),a("#mybookings_notif").show())},b.prototype.paginate=function(){for(this.log("Updating pagination");a("ul.pagination li").length>2;)a("ul.pagination li").first().next().remove();for(var b,c=Math.ceil(a("#mybookings tbody tr").length/10),d=1;d<=c;d++)b=a('<li class="page-item"><a class="page-link">'+d+"</a></li>"),a("ul.pagination li.page-item").last().prev().after(b);var e,f,g,h,i,j,k;a(".pagination .page-item").click(function(b){b.preventDefault(),e=a("ul.pagination li").length,f=a(".pagination .page-item.active"),g=0==a(this).index()?1==f.index()?a("ul.pagination li.page-item").last().prev():f.prev():a(this).index()==e-1?f.index()==e-2?a("ul.pagination li.page-item").first().next():f.next():a(this),f.removeClass("active"),g.addClass("active"),h=a("ul.pagination li.page-item.active").index(),a("#mybookings tbody tr").hide(),i=a("#mybookings tbody tr").length,j=10*(h-1)+1,k=10*h,a(this).index()==e-2&&(k=i);for(var c=j;c<=k;c++)a("#mybookings tbody tr:nth-child("+c+")").show()}),a("ul.pagination li.page-item:first-child").next().click()},b.prototype.on_delete_item=function(b){var c=b.data.mybookings,d=b.data.datepicker,e=b.data.timepicker;c.log("delete <EVENT>"),b.preventDefault();var f=a("#del-confirm").html();if(confirm(f)){var g=b.data.mybookings.delete_base_url+"&bookid="+b.data.bookid,h=a(this);a.getJSON(g,function(a){c.log("GET "+g);var b=h.closest("tr"),f=b.find("td:nth-child(2)").text(),i=b.find("td:nth-child(4)").text();b.remove(),d.delete_booking(f,i),d.refresh(),f==d.get()&&(e.del_busy(i),e.update_busy_interv()),c.update_visibility(),c.paginate()})}},b});