define(["jquery","jqueryui"],function(a){var b=function(b){this.debug=b.debug,this.delete_base_url=b.controllerspath+"/delete_booking.php?id="+b.course_id,this.elem=a("table#mybookings"),this.datepicker=b.datepicker,this.timepicker=b.timepicker,this.log("Creating object")};return b.prototype.log=function(a){this.debug&&console.log("[TABLE] "+a)},b.prototype.populate=function(a){this.log("Clearing"),this.elem.children("tbody").html(""),this.log("Populating");for(var b=0;b<a.bookings.length;b++){bk=a.bookings[b];var c=this.create_row(bk.day,bk.labname,bk.time,bk.id);this.append_item(c)}this.update_visibility(),a.bookings.length>0&&this.paginate()},b.prototype.append_item=function(a){this.elem.find("tbody").append(a)},b.prototype.create_row=function(b,c,d,e){var f=a("<tr><td> &nbsp; </td><td>"+b+"</td><td>"+c+"</td><td>"+d+'</td><td class="text-center del_btn_cell" id="'+e+'"><a class="del_btn"><span class="ui-icon ui-icon-trash" >&nbsp;</span></a></td></tr>');return f.find("a").on("click",{mybookings:this,timepicker:this.timepicker,datepicker:this.datepicker,bookid:e},this.on_delete_item),f},b.prototype.update=function(a,b,c,d){var e=this.create_row(a,b,c,d);this.add_sorted(a,c,e),this.update_visibility()},b.prototype.add_sorted=function(b,c,d){var e=new Date(b+" "+c);return 0==this.elem.find("tbody").children().length?void this.elem.find("tbody").html(d):void this.elem.find("tbody > tr").each(function(){var b=a(this).find("td:nth-child(2)").text(),c=a(this).find("td:nth-child(4)").text(),f=new Date(b+" "+c);return e<f?(a(this).before(d),!1):void(a(this).is(":last-child")&&a(this).after(d))})},b.prototype.update_visibility=function(){var b=this.elem.find("tbody > tr").length;this.log("Updating visibility ("+b+")"),b>0?(this.log("contain items"),this.elem.show(),a("#pagination").show(),a("#mybookings_notif").hide()):(this.log("empty"),this.elem.hide(),a("#pagination").hide(),a("#mybookings_notif").show())},b.prototype.paginate=function(){for(this.log("Updating pagination");a("ul.pagination li").length>2;)a("ul.pagination li").first().next().remove();for(count=Math.ceil(a("#mybookings tbody tr").length/10),i=1;i<=count;i++)item=a('<li class="page-item"><a class="page-link">'+i+"</a></li>"),a("ul.pagination li.page-item").last().prev().after(item);a(".pagination .page-item").click(function(b){for(b.preventDefault(),items=a("ul.pagination li").length,old=a(".pagination .page-item.active"),0==a(this).index()?1==old.index()?cur=a("ul.pagination li.page-item").last().prev():cur=old.prev():a(this).index()==items-1?old.index()==items-2?cur=a("ul.pagination li.page-item").first().next():cur=old.next():cur=a(this),old.removeClass("active"),cur.addClass("active"),page=a("ul.pagination li.page-item.active").index(),a("#mybookings tbody tr").hide(),total=a("#mybookings tbody tr").length,first=10*(page-1)+1,last=10*page,a(this).index()==items-2&&(last=total),i=first;i<=last;i++)a("#mybookings tbody tr:nth-child("+i+")").show()}),a("ul.pagination li.page-item:first-child").next().click()},b.prototype.on_delete_item=function(b){var c=b.data.mybookings,d=b.data.datepicker,e=b.data.timepicker;c.log("delete <EVENT>"),b.preventDefault();var f=a("#del-confirm").html();if(confirm(f)){var g=b.data.mybookings.delete_base_url+"&bookid="+b.data.bookid,h=a(this);a.getJSON(g,function(a){c.log("GET "+g);var b=h.closest("tr"),f=b.find("td:nth-child(2)").text(),i=b.find("td:nth-child(4)").text();b.remove(),d.delete_booking(f,i),d.refresh(),f==d.get()&&(e.del_busy(i),e.update_busy_interv()),c.update_visibility(),c.paginate()})}},b});