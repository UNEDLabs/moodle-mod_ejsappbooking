define(["jquery","jqueryui","mod_ejsappbooking/lab_select","mod_ejsappbooking/practice_select","mod_ejsappbooking/date_picker","mod_ejsappbooking/time_picker","mod_ejsappbooking/notif_area"],function(a,b,c,d,e,f,g){var h=function(b){this.debug=b.debug,this.log("Creating object"),this.elem=a("#bookingform"),this.disabled=!1,this.labsel=new c(this.debug),this.pracsel=new d(this.debug),this.datepicker=new e(this.debug),this.timepicker=new f(this.debug),this.notifarea=new g(this.debug),this.labsel.on_select_setup({urlbase:b.controllerspath,course:b.course_id,lab_sel:this.labsel,prac_sel:this.pracsel,time_picker:this.timepicker,notif_area:this.notifarea,booking_form:this}),this.datepicker.on_date_change_setup({urlbase:b.controllerspath,course_id:b.course_id,lab_id:this.labsel.get_lab(),timepicker:this.timepicker}),this.on_submit_setup({urlbase:b.controllerspath,lab_sel:this.labsel,prac_sel:this.pracsel,time_picker:this.timepicker,date_picker:this.datepicker,notif_area:this.notifarea}),this.labsel.first(),this.datepicker.set_today();var h=this.datepicker,i=this.labsel.get_lab(),j=this.timepicker;setInterval(function(){h.update({urlbase:b.controllerspath,course_id:b.course_id,lab_id:i,timepicker:j})},5e3)};return h.prototype.log=function(a){this.debug&&console.log("[FORM] "+a)},h.prototype.disable=function(){this.elem.disabled=!0},h.prototype.enable=function(){this.elem.disabled=!1},h.prototype.is_disabled=function(){return this.elem.disabled},h.prototype.attach=function(a){this.mybooking_table=a},h.prototype.on_submit_setup=function(b){var c=this;c.elem.on("submit",b,function(b){c.log("on submit <EVENT> "),b.preventDefault();var d=c.elem.attr("action"),e=b.data.lab_sel.get_lab(),f=b.data.prac_sel.get(),g=b.data.date_picker.get(),h=b.data.time_picker.get_current_time();if(c.is_disabled())return c.log("Disabled"),void alert("This plant is not active at that moment. Unable to book.");c.log("Enabled");var i=b.data.time_picker,j=b.data.notif_area;if(!(e||f||g||h))return j.display(".submit-missing-field"),void c.log("ERROR: Missing field on submiting form");var k=d+"&labid="+e+"&practid="+f+"&date="+g+"&time="+h,l=b.data.lab_sel.get_lab_name(),m=b.data.prac_sel.get_prac_name();c.log("POST "+k),a.getJSON({method:"POST",url:k,dataType:"json",contentType:"application/json",success:function(a){j.clear(),a.exitCode>=0?(j.display_msg(a.exitMsg,"alert-success"),i.next_free_interv(),c.mybooking_table.update(g,l+". "+m,h,a.bookid),c.datepicker.add_booking(g,h,l+". "+m),c.datepicker.refresh(),c.timepicker.add_busy(h),c.timepicker.update_busy_interv()):j.display_msg(a.exitMsg,"alert-danger")},error:function(a,b,d){c.log(d),j.display_msg(d,"alert-danger")},complete:function(a){}})})},h});