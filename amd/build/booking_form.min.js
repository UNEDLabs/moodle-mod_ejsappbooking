define(["jquery","jqueryui","amd/src/lab_select.js","amd/src/practice_select.js","amd/src/date_picker.js","amd/src/time_picker.js","amd/src/notif_area.js"],function(a,b,c,d,e,f,g){var h=function(b){this.debug=b.debug,this.log("Creating object"),this.elem=a("#bookingform"),this.disabled=!1,this.labsel=new c(this.debug),this.pracsel=new d(this.debug),this.datepicker=new e(this.debug),this.timepicker=new f(this.debug),this.notifarea=new g(this.debug),this.labsel.on_select_setup({urlbase:b.controllerspath,course:b.course_id,lab_sel:this.labsel,prac_sel:this.pracsel,time_picker:this.timepicker,notif_area:this.notifarea,booking_form:this}),this.datepicker.on_date_change_setup({urlbase:b.controllerspath,course_id:b.course_id,lab_id:this.labsel.get_lab(),timepicker:this.timepicker}),this.on_submit_setup({urlbase:b.controllerspath,lab_sel:this.labsel,prac_sel:this.pracsel,time_picker:this.timepicker,date_picker:this.datepicker,notif_area:this.notifarea}),this.labsel.first(),this.datepicker.set_today()};return h.prototype.log=function(a){this.debug&&console.log("[FORM] "+a)},h.prototype.disable=function(){this.elem.disabled=!0},h.prototype.enable=function(){this.elem.disabled=!1},h.prototype.is_disabled=function(){return this.elem.disabled},h.prototype.attach=function(a){this.mybooking_table=a},h.prototype.on_submit_setup=function(b){var c=this;c.elem.on("submit",b,function(b){c.log("on submit <EVENT> "),b.preventDefault();var d=(b.data.urlbase+c.elem.attr("action"),b.data.lab_sel.get_lab()),e=b.data.prac_sel.get(),f=b.data.date_picker.get(),g=b.data.time_picker.get_current_time();if(c.is_disabled())return c.log("Disabled"),void alert("This plant is not active at that moment.Unable to book.");c.log("Enabled");var h=b.data.time_picker,i=b.data.notif_area;if(!(d||e||f||g))return i.display(".submit-missing-field"),void c.log("ERROR: Missing field on submiting form");var j="http://moodle.local"+c.elem.attr("action")+"&labid="+d+"&practid="+e+"&date="+f+"&time="+g,k=b.data.lab_sel.get_lab_name(),l=b.data.prac_sel.get_prac_name();c.log("POST "+j),a.getJSON({method:"POST",url:j,dataType:"json",contentType:"application/json",success:function(a){i.clear(),a.exitCode>=0?(i.display_msg(a.exitMsg,"alert-success"),h.next_free_interv(),c.mybooking_table.update(f,k+". "+l,g,a.bookid),c.datepicker.add_booking(f,g,k+". "+l),c.datepicker.refresh(),c.timepicker.add_busy(g),c.timepicker.update_busy_interv()):i.display_msg(a.exitMsg,"alert-danger")},error:function(a,b,d){c.log(d),i.display_msg(d,"alert-danger")},complete:function(a){}})})},h});